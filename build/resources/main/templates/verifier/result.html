<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>VP Verification Result</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 50px; background: #f8f9fa; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
    .success { background: #d4edda; color: #155724; padding: 20px; border-radius: 4px; margin: 20px 0; }
    .token-box { background: #f8f9fa; padding: 15px; border-radius: 4px; word-break: break-all; max-height: 200px; overflow-y: auto; margin: 15px 0; }
    .dcql-results { background: #e7f3ff; padding: 20px; border-radius: 4px; margin: 20px 0; }
    .dcql-data { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 4px; }
    .button { background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; }
    .nav-links { margin-bottom: 20px; }
    .nav-links a { margin-right: 15px; text-decoration: none; color: #007bff; }
  </style>
</head>
<body>
<div class="container">
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/oid4vp/test">Back to Test</a>
  </div>

  <h1>🔐 VP Verification Result</h1>

  <div class="success">
    ✅ VP Token successfully received and verified!
  </div>

  <div th:if="${presentationSubmission}">
    <h3>📋 Presentation Submission:</h3>
    <div class="token-box" th:text="${presentationSubmission}">Presentation Submission content</div>
  </div>

  <!-- DCQL Results Section -->
  <div th:if="${dcqlResult}" class="dcql-results">
    <h3>🔍 DCQL Query Results</h3>

    <div th:if="${dcqlResult.success}">
      <p><strong>✅ Query executed successfully!</strong></p>
      <p>📊 <strong>Total matches:</strong> <span th:text="${dcqlResult.totalMatches}">0</span></p>
      <p>⏱️ <strong>Execution time:</strong> <span th:text="${dcqlResult.executionTimeMs}">0</span>ms</p>

      <div th:if="${dcqlResult.data != null and !dcqlResult.data.empty}">
        <h4>📋 Extracted Data:</h4>
        <div th:each="item, iterStat : ${dcqlResult.data}" class="dcql-data">
          <strong>Record <span th:text="${iterStat.count}">1</span>:</strong>
          <div th:each="entry : ${item}">
            <strong th:text="${entry.key}">field</strong>: <span th:text="${entry.value}">value</span>
          </div>
        </div>
      </div>
    </div>

    <div th:unless="${dcqlResult.success}">
      <p><strong>❌ DCQL Query failed:</strong></p>
      <p th:text="${dcqlResult.message}">Error message</p>
    </div>

    <div th:if="${dcqlResult.originalQuery}">
      <h4>🔍 Original Query:</h4>
      <div class="token-box">
        <div>
          <strong>FROM:</strong> <span th:text="${dcqlResult.originalQuery.from}">N/A</span>
        </div>
        <div th:if="${dcqlResult.originalQuery.select}">
          <strong>SELECT:</strong> <span th:text="${#strings.listJoin(dcqlResult.originalQuery.select, ', ')}">*</span>
        </div>
        <div th:if="${dcqlResult.originalQuery.where}">
          <strong>WHERE:</strong>
          <div th:each="condition : ${dcqlResult.originalQuery.where}">
            <span th:text="${condition.key + ' = ' + condition.value}">condition</span>
          </div>
        </div>
        <div th:if="${dcqlResult.originalQuery.limit}">
          <strong>LIMIT:</strong> <span th:text="${dcqlResult.originalQuery.limit}">N/A</span>
        </div>
      </div>
    </div>
  </div>

  <div th:if="${state}">
    <h3>🏷️ State:</h3>
    <div class="token-box" th:text="${state}">State value</div>
  </div>

  <div style="margin-top: 30px;">
    <a href="/oid4vp/test" class="button">🔄 Test Again</a>
    <a href="/" class="button" style="background: #6c757d;">🏠 Home</a>
  </div>
</div>
</body>
</html>