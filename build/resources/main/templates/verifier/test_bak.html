<html lang="ko"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OID4VP Verifier Test Console</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <style>
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .tab-button.active {
      border-bottom: 3px solid #3b82f6;
      color: #3b82f6;
    }
    .json-editor {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
    }
    .flow-diagram {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .sub-tab-content { display: none; }
    .sub-tab-content.active { display: block; }
    .sub-tab-button.active {
      background-color: #3b82f6;
      color: white;
    }
    .request-mode-content { display: none; }
    .request-mode-content.active { display: block; }
  </style>
  <style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.fixed{position:fixed}.relative{position:relative}.inset-0{inset:0px}.top-20{top:5rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mr-2{margin-right:0.5rem}.mt-3{margin-top:0.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.ml-2{margin-left:0.5rem}.ml-4{margin-left:1rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-96{height:24rem}.h-full{height:100%}.max-h-64{max-height:16rem}.max-h-96{max-height:24rem}.w-3\/4{width:75%}.w-48{width:12rem}.w-full{width:100%}.max-w-4xl{max-width:56rem}.max-w-7xl{max-width:80rem}.flex-1{flex:1 1 0%}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-6{gap:1.5rem}.gap-8{gap:2rem}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-8 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(2rem * var(--tw-space-x-reverse));margin-left:calc(2rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.overflow-auto{overflow:auto}.overflow-y-auto{overflow-y:auto}.break-all{word-break:break-all}.rounded{border-radius:0.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.rounded-t-lg{border-top-left-radius:0.5rem;border-top-right-radius:0.5rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-b-2{border-bottom-width:2px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-500{--tw-bg-opacity:1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.bg-gray-600{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-green-100{--tw-bg-opacity:1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-orange-100{--tw-bg-opacity:1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1))}.bg-orange-600{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}.bg-purple-100{--tw-bg-opacity:1;background-color:rgb(243 232 255 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-100{--tw-bg-opacity:1;background-color:rgb(254 249 195 / var(--tw-bg-opacity, 1))}.bg-yellow-50{--tw-bg-opacity:1;background-color:rgb(254 252 232 / var(--tw-bg-opacity, 1))}.bg-opacity-20{--tw-bg-opacity:0.2}.bg-opacity-50{--tw-bg-opacity:0.5}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-1{padding-left:0.25rem;padding-right:0.25rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-8{padding-top:2rem;padding-bottom:2rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity:1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}.text-green-400{--tw-text-opacity:1;color:rgb(74 222 128 / var(--tw-text-opacity, 1))}.text-green-800{--tw-text-opacity:1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.text-orange-800{--tw-text-opacity:1;color:rgb(154 52 18 / var(--tw-text-opacity, 1))}.text-purple-800{--tw-text-opacity:1;color:rgb(107 33 168 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-800{--tw-text-opacity:1;color:rgb(133 77 14 / var(--tw-text-opacity, 1))}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity:1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-50:hover{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-orange-700:hover{--tw-bg-opacity:1;background-color:rgb(194 65 12 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.hover\:text-red-800:hover{--tw-text-opacity:1;color:rgb(153 27 27 / var(--tw-text-opacity, 1))}.focus\:border-blue-500:focus{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.focus\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity, 1))}@media (min-width: 1024px){.lg\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}</style><style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.fixed{position:fixed}.relative{position:relative}.inset-0{inset:0px}.top-20{top:5rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.ml-2{margin-left:0.5rem}.ml-4{margin-left:1rem}.mr-2{margin-right:0.5rem}.mt-3{margin-top:0.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-96{height:24rem}.h-full{height:100%}.max-h-64{max-height:16rem}.max-h-96{max-height:24rem}.w-3\/4{width:75%}.w-48{width:12rem}.w-full{width:100%}.max-w-4xl{max-width:56rem}.max-w-7xl{max-width:80rem}.flex-1{flex:1 1 0%}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-6{gap:1.5rem}.gap-8{gap:2rem}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-8 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(2rem * var(--tw-space-x-reverse));margin-left:calc(2rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.overflow-auto{overflow:auto}.overflow-y-auto{overflow-y:auto}.break-all{word-break:break-all}.rounded{border-radius:0.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.rounded-t-lg{border-top-left-radius:0.5rem;border-top-right-radius:0.5rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-b-2{border-bottom-width:2px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-500{--tw-bg-opacity:1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.bg-gray-600{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-green-100{--tw-bg-opacity:1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-orange-100{--tw-bg-opacity:1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1))}.bg-orange-600{--tw-bg-opacity:1;background-color:rgb(234 88 12 / var(--tw-bg-opacity, 1))}.bg-purple-100{--tw-bg-opacity:1;background-color:rgb(243 232 255 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-100{--tw-bg-opacity:1;background-color:rgb(254 249 195 / var(--tw-bg-opacity, 1))}.bg-yellow-50{--tw-bg-opacity:1;background-color:rgb(254 252 232 / var(--tw-bg-opacity, 1))}.bg-opacity-20{--tw-bg-opacity:0.2}.bg-opacity-50{--tw-bg-opacity:0.5}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-1{padding-left:0.25rem;padding-right:0.25rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-8{padding-top:2rem;padding-bottom:2rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity:1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}.text-green-400{--tw-text-opacity:1;color:rgb(74 222 128 / var(--tw-text-opacity, 1))}.text-green-800{--tw-text-opacity:1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.text-orange-800{--tw-text-opacity:1;color:rgb(154 52 18 / var(--tw-text-opacity, 1))}.text-purple-800{--tw-text-opacity:1;color:rgb(107 33 168 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity:1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-800{--tw-text-opacity:1;color:rgb(133 77 14 / var(--tw-text-opacity, 1))}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-50:hover{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-orange-700:hover{--tw-bg-opacity:1;background-color:rgb(194 65 12 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.hover\:text-red-800:hover{--tw-text-opacity:1;color:rgb(153 27 27 / var(--tw-text-opacity, 1))}.focus\:border-blue-500:focus{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.focus\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity, 1))}@media (min-width: 1024px){.lg\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}</style></head>
<body class="bg-gray-50">
<div class="container mx-auto px-4 py-8 max-w-7xl">
  <!-- Header -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">OID4VP Verifier Test Console</h1>
    <p class="text-gray-600">OpenID for Verifiable Presentations 1.0 - Advanced Testing Interface</p>
    <div class="mt-4 flex flex-wrap gap-2">
      <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">DCQL Support</span>
      <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">Scope Mapping</span>
      <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm">Multi-Format</span>
      <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm">Direct Post</span>
      <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">Request URI</span>
    </div>
  </div>

  <!-- Main Tabs -->
  <div class="bg-white rounded-lg shadow-md mb-6">
    <div class="border-b border-gray-200">
      <nav class="flex space-x-8 px-6" aria-label="Tabs">
        <button onclick="switchTab('dcql')" class="tab-button py-4 px-1 border-b-2 font-medium text-sm active">
          DCQL Query Builder
        </button>
        <button onclick="switchTab('direct-test')" class="tab-button py-4 px-1 border-b-2 font-medium text-sm">
          Direct Test
        </button>
        <button onclick="switchTab('flow')" class="tab-button py-4 px-1 border-b-2 font-medium text-sm">
          Flow Visualization
        </button>
        <button onclick="switchTab('logs')" class="tab-button py-4 px-1 border-b-2 font-medium text-sm">
          Debug Logs
        </button>
        <button onclick="switchTab('scope')" class="tab-button py-4 px-1 border-b-2 font-medium text-sm">
          Scope Mapping
        </button>
      </nav>
    </div>

    <!-- DCQL Query Builder Tab -->
    <div id="dcql-tab" class="tab-content p-6 active">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Query Builder -->
        <div>
          <h3 class="text-lg font-semibold mb-4">Build DCQL Query</h3>

          <!-- Quick Templates -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Quick Templates</label>
            <select onchange="loadTemplate(this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md">
              <option value="">-- Select Template --</option>
              <option value="tec" selected>TEC Student ID Credential (Custom)</option>
              <option value="identity">Identity Credential</option>
              <option value="age">Age Verification</option>
              <option value="education">Education Credential</option>
              <option value="driver">Driver License (mDL)</option>
              <option value="complex">Complex Multi-Credential</option>
            </select>
          </div>

          <!-- DCQL Editor -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">DCQL Query JSON</label>
            <textarea id="dcqlQuery" rows="15" class="json-editor w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="{&quot;credentials&quot;: [...]}">{
  "credentials": [
    {
      "id": "tec_student_id",
      "format": "vc",
      "multiple": false,
      "meta": {
        "issuer_values": [
          "did:omn:issuer"
        ]
      }
    }
  ]
}</textarea>
          </div>

          <!-- Validation -->
          <div class="flex space-x-2">
            <button onclick="validateDCQL()" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
              Validate DCQL
            </button>
            <button onclick="formatJSON()" class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
              Format JSON
            </button>
          </div>
        </div>

        <!-- Options & Preview -->
        <div>
          <h3 class="text-lg font-semibold mb-4">Request Options</h3>

          <!-- Request Mode Selection -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Request Mode</label>
            <div class="space-y-2">
              <label class="flex items-center">
                <input type="radio" name="requestMode" value="by_value" onchange="switchRequestMode('by_value')" class="mr-2 text-blue-600">
                <span>By Value (All parameters in URL)</span>
              </label>
              <label class="flex items-center">
                <input type="radio" name="requestMode" value="request_uri" onchange="switchRequestMode('request_uri')" checked class="mr-2 text-blue-600">
                <span>Request URI (Wallet fetches from /request/{id})</span>
              </label>
            </div>
          </div>

          <!-- By Value Options -->
          <div id="byValueOptions" class="request-mode-content">
            <!-- Response Mode -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Response Mode</label>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="responseMode" value="direct_post" checked="" class="mr-2 text-blue-600">
                  <span>direct_post (Recommended)</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="responseMode" value="redirect" class="mr-2 text-blue-600">
                  <span>redirect</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Request URI Options -->
          <div id="requestUriOptions" class="request-mode-content active">
            <div class="bg-yellow-50 p-3 rounded-md mb-4">
              <p class="text-sm text-yellow-800">
                <strong>Request URI Mode:</strong> Only client_id and request_uri will be sent to wallet.
                The wallet will fetch the full request from the provided URI.
              </p>
            </div>

            <!-- Response Mode for Request URI -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Response Mode (for fetched request)</label>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="radio" name="responseMode" value="direct_post" checked="" class="mr-2 text-blue-600">
                  <span>direct_post</span>
                </label>
                <label class="flex items-center">
                  <input type="radio" name="responseMode" value="redirect" class="mr-2 text-blue-600">
                  <span>redirect</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Client Metadata -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Client Metadata (Optional)
            </label>
            <textarea id="clientMetadata" rows="4" class="json-editor w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="{&quot;client_name&quot;: &quot;Test Verifier&quot;}">{
  "client_name": "OID4VP Test Verifier",
  "logo_uri": "https://example.com/logo.png"
}</textarea>
          </div>

          <!-- Initiate Button -->
          <button onclick="initiateVerification()" class="w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 font-medium">
            Initiate Verification Session
          </button>

          <!-- Results Display -->
          <div id="qrContainer" class="mt-6 hidden">
            <h4 class="text-md font-semibold mb-3">Verification Session</h4>

            <!-- QR Code -->
            <div class="bg-gray-100 p-4 rounded-lg text-center mb-4">
              <div id="qrcode" class="inline-block" title="openid4vp://?request_uri=http%3A%2F%2F10.48.201.106%3A8082%2Foid4vp%2Frequest%2Ff1432d32-5306-459e-b889-92460bbc2054&amp;client_id=redirect_uri%3Ahttp%3A%2F%2F10.48.201.106%3A8082%2Foid4vp%2Fcallback"><canvas width="256" height="256" style="display: none;"></canvas><img src="data:image/png;base64,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" style="display: block;"></div>
              <p class="mt-3 text-sm text-gray-600">Request ID: <span id="requestId" class="font-mono">f1432d32-5306-459e-b889-92460bbc2054</span></p>
            </div>

            <!-- URLs Display -->
            <div class="space-y-3">
              <!-- Authorization Request URL -->
              <div class="p-3 bg-white rounded border border-gray-300">
                <p class="text-xs text-gray-500 mb-1">Authorization Request URL:</p>
                <p id="authRequestUrl" class="text-xs font-mono break-all text-gray-700">openid4vp://?request_uri=http%3A%2F%2F10.48.201.106%3A8082%2Foid4vp%2Frequest%2Ff1432d32-5306-459e-b889-92460bbc2054&amp;client_id=redirect_uri%3Ahttp%3A%2F%2F10.48.201.106%3A8082%2Foid4vp%2Fcallback</p>
              </div>

              <!-- Request URI (shown only in Request URI mode) -->
              <div id="requestUriDisplay" class="p-3 bg-white rounded border border-gray-300">
                <p class="text-xs text-gray-500 mb-1">Request URI (for wallet to fetch):</p>
                <p id="requestUri" class="text-xs font-mono break-all text-gray-700">http://10.48.201.106:8082/oid4vp/request/f1432d32-5306-459e-b889-92460bbc2054</p>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-4 space-y-2">
              <!-- Same Device Flow Button -->
              <button onclick="openInSameDevice()" class="w-full bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                Open in Same Device (Wallet)
              </button>

              <!-- Test Request URI Button (shown only in Request URI mode) -->
              <button id="testRequestUriBtn" onclick="testRequestUri()" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                Test Request URI Endpoint
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Validation Results -->
      <div id="validationResults" class="mt-6 hidden">
        <h3 class="text-lg font-semibold mb-3">Validation Results</h3>
        <div id="validationContent" class="bg-gray-100 p-4 rounded-lg"></div>
      </div>
    </div>

    <!-- Scope Mapping Tab -->
    <div id="scope-tab" class="tab-content p-6">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div>
          <h3 class="text-lg font-semibold mb-4">Test Scope to DCQL Mapping</h3>

          <!-- Predefined Scopes -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Available Scopes</label>
            <div class="space-y-2">
              <label class="flex items-center">
                <input type="checkbox" value="identity_credential" class="scope-checkbox mr-2">
                <span>identity_credential</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" value="age_verification" class="scope-checkbox mr-2">
                <span>age_verification</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" value="openid" class="scope-checkbox mr-2">
                <span>openid (standard)</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" value="profile" class="scope-checkbox mr-2">
                <span>profile (standard)</span>
              </label>
            </div>
          </div>

          <!-- Custom Scope -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Custom Scope String</label>
            <input type="text" id="customScope" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="scope1 scope2 scope3">
          </div>

          <button onclick="testScopeMapping()" class="w-full bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
            Test Scope → DCQL Conversion
          </button>
        </div>

        <div>
          <h3 class="text-lg font-semibold mb-4">Mapped DCQL Result</h3>
          <pre id="scopeMappingResult" class="bg-gray-100 p-4 rounded-lg overflow-auto h-96 language-json" tabindex="0"><code class="language-json"><span class="token comment">// Scope mapping result will appear here</span></code>
          </pre>
        </div>
      </div>
    </div>

    <!-- Direct Test Tab -->
    <div id="direct-test-tab" class="tab-content p-6">
      <h3 class="text-lg font-semibold mb-4">Direct VP Token Test</h3>

      <!-- Sub tabs for different test modes -->
      <div class="mb-6">
        <div class="flex space-x-4 border-b">
          <button onclick="switchDirectTestSubTab('mock')" class="sub-tab-button px-4 py-2 rounded-t-lg active">
            VP Token
          </button>
        </div>
      </div>

      <!-- Manual VP Token Test -->
      <div id="manual-test-tab" class="sub-tab-content">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div>
            <h4 class="text-md font-semibold mb-3">Paste VP Token</h4>

            <!-- State Parameter -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">State (from session)</label>
              <input type="text" id="manualState" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Enter state parameter">
            </div>

            <!-- VP Token -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">VP Token (JWT)</label>
              <textarea id="manualVpToken" rows="10" class="json-editor w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Paste your VP Token JWT here..."></textarea>
            </div>

            <button onclick="submitManualVPToken()" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
              Submit VP Token
            </button>
          </div>

          <div>
            <h4 class="text-md font-semibold mb-3">Response</h4>
            <pre id="manualTestResponse" class="bg-gray-100 p-4 rounded-lg overflow-auto h-96 language-json" tabindex="0"><code class="language-json"><span class="token comment">// Response will appear here</span></code>
            </pre>
          </div>
        </div>
      </div>

      <!-- Mock Wallet Test -->
      <div id="mock-test-tab" class="sub-tab-content active">
        <div class="space-y-6">
          <!-- Configuration Section -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              <h4 class="text-md font-semibold mb-3">Mock Wallet Configuration</h4>

              <!-- Select Active Session -->
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Select Active Session</label>
                <select id="mockSessionSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md" onchange="updateSessionDetails()"><option value="">-- Select a session --</option></select>
              </div>

              <!-- Mock Credential -->
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Mock Credential</label>
                <textarea id="mockCredential" rows="10" class="json-editor w-full px-3 py-2 border border-gray-300 rounded-md">{
   "@context":[
      "https://www.w3.org/ns/credentials/v2"
   ],
   "credentialSchema":{
      "id":"http://10.48.17.124:8099/issuer/api/v1/vc/vcschema?name=tec.student_id",
      "type":"OsdSchemaCredential"
   },
   "credentialSubject":{
      "claims":[
         {
            "caption":"Photo",
            "code":"cr.ac.tec.photo.student_id",
            "format":"plain",
            "hideValue":false,
            "type":"image",
            "value":"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"
         },
         {
            "caption":"Name",
            "code":"cr.ac.tec.student_id.name",
            "format":"plain",
            "hideValue":false,
            "type":"text",
            "value":"Raon Kim"
         },
         {
            "caption":"Student ID",
            "code":"cr.ac.tec.student_id.student_id",
            "format":"plain",
            "hideValue":false,
            "type":"text",
            "value":"tec001"
         },
         {
            "caption":"Emision Date",
            "code":"cr.ac.tec.student_id.emision_date",
            "format":"plain",
            "hideValue":false,
            "type":"text",
            "value":"2025.08.01"
         },
         {
            "caption":"Expiration Date",
            "code":"cr.ac.tec.student_id.expiration_date",
            "format":"plain",
            "hideValue":false,
            "type":"text",
            "value":"2035.08.01"
         },
         {
            "caption":"Major",
            "code":"cr.ac.tec.student_id.major",
            "format":"plain",
            "hideValue":false,
            "type":"text",
            "value":"test"
         },
         {
            "caption":"University Branch",
            "code":"cr.ac.tec.student_id.university_branch",
            "format":"plain",
            "hideValue":false,
            "type":"text",
            "value":"test"
         }
      ],
      "id":"did:omn:2m9e4mZ681NySDVRLqBNYXtBBCbW"
   },
   "encoding":"UTF-8",
   "evidence":[
      {
         "documentPresence":"Physical",
         "evidenceDocument":"BusinessLicense",
         "subjectPresence":"Physical",
         "type":"DocumentVerification",
         "verifier":"did:omn:tas"
      }
   ],
   "formatVersion":"1.0",
   "id":"9419575e-8d8c-4577-849a-e1d057ca1345",
   "issuanceDate":"2025-07-30T02:45:03Z",
   "issuer":{
      "id":"did:omn:issuer",
      "name":"issuer"
   },
   "language":"ko",
   "proof":{
      "created":"2025-07-30T02:45:03Z",
      "proofPurpose":"assertionMethod",
      "proofValue":"mIBsC4p8JFcVfUq07wTgRyXXmmmeAy4Kdkw5bf1DYLFiqTskXTGpqV6RGVcA3v7/z6R1RgKQLLyEXt/YHx0jeem4",
      "proofValueList":[
         "mH3CvwdPfFSpYw5I602tXn+1iyE9MpVvUlOObWUi3ZBbxHP14oOiZ7g97m9WT6VNUx7ePyQWep/8N6vbGZbdMIG4",
         "mHxT06yaCVroALdXKMX3E1iaOFwr7OyajVFSSY0nO9IgCKOhGdVdPif1Gm/3Mg3g0hKcQvuRuHjbu3tzmjDSigvo",
         "mH7EGmTHnznY2R/gjcLzomG1R/jLIGzhJHg/c4BGaAIGMaAbp3zAzdJz/AuN2kJGUD1s/OXwcZwtXRKyzQHUqPyM",
         "mIF765kKT9YOE1s2W1exUvkOnSgW/a2xhAQw8Nr6mdW/LAUJwDzLB6bfAaM4SFbWRF8iI+q4cKBtVXkV/0jktyuM",
         "mH3CvwdPfFSpYw5I602tXn+1iyE9MpVvUlOObWUi3ZBbxHP14oOiZ7g97m9WT6VNUx7ePyQWep/8N6vbGZbdMIG4",
         "mH3CvwdPfFSpYw5I602tXn+1iyE9MpVvUlOObWUi3ZBbxHP14oOiZ7g97m9WT6VNUx7ePyQWep/8N6vbGZbdMIG4",
         "mIPmjZyC1kGxqnvRi8j4h6JAkDmWW9Th0TAVTNlUIABGcAoJRZP4LlEE8ygltHUW1DASeqE2LZViI7il00zhgmqY"
      ],
      "type":"Secp256r1Signature2018",
      "verificationMethod":"did:omn:issuer?versionId=1#assert"
   },
   "type":[
      "VerifiableCredential"
   ],
   "validFrom":"2025-07-30T02:45:03Z",
   "validUntil":"2026-07-30T02:45:03Z"
}</textarea>
              </div>

              <button onclick="sendMockResponse()" class="w-full bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700">
                Send Mock Wallet Response
              </button>
            </div>

            <div>
              <h4 class="text-md font-semibold mb-3">Session Details</h4>
              <div id="sessionDetails" class="bg-gray-100 p-4 rounded-lg overflow-auto max-h-96">
                <p class="text-sm text-gray-500">세션 세부사항이 여기에 표시됩니다...</p>
              </div>
            </div>
          </div>

          <!-- Results Section (separated) -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Generated VP Token -->
            <div>
              <h4 class="text-md font-semibold mb-3">Generated VP Token</h4>
              <div class="space-y-3">
                <!-- JWT Display -->
                <div>
                  <label class="text-sm text-gray-600">JWT Token:</label>
                  <textarea id="generatedJWT" rows="4" readonly class="json-editor w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-xs" placeholder="JWT will appear here after generating VP token"></textarea>
                </div>

                <!-- Decoded Token -->
                <div>
                  <label class="text-sm text-gray-600">Decoded Token:</label>
                  <pre id="decodedToken" class="bg-gray-100 p-4 rounded-lg overflow-auto max-h-64 language-json" tabindex="0"><code class="language-json"><span class="token comment">// Decoded token will appear here</span></code></pre>ken property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"payload"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"iss"</span><span class="token operator">:</span> <span class="token string">"https://wallet.example.com"</span><span class="token punctuation">,</span>
    <span class="token property">"aud"</span><span class="token operator">:</span> <span class="token string">"redirect_uri:http://10.48.201.106:8082/oid4vp/response"</span><span class="token punctuation">,</span>
    <span class="token property">"iat"</span><span class="token operator">:</span> <span class="token number">1757035661</span><span class="token punctuation">,</span>
    <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1757039261</span><span class="token punctuation">,</span>
    <span class="token property">"nonce"</span><span class="token operator">:</span> <span class="token string">"e75e54ff-253b-423e-a489-0116e43b0b96"</span><span class="token punctuation">,</span>
    <span class="token property">"vp"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"@context"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"https://www.w3.org/2018/credentials/v1"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"VerifiablePresentation"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"verifiableCredential"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">"@context"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"https://www.w3.org/ns/credentials/v2"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"credentialSchema"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"http://10.48.17.124:8099/issuer/api/v1/vc/vcschema?name=tec.student_id"</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"OsdSchemaCredential"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"credentialSubject"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"claims"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                <span class="token property">"caption"</span><span class="token operator">:</span> <span class="token string">"Photo"</span><span class="token punctuation">,</span>
                <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"cr.ac.tec.photo.student_id"</span><span class="token punctuation">,</span>
                <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"plain"</span><span class="token punctuation">,</span>
                <span class="token property">"hideValue"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"image"</span><span class="token punctuation">,</span>
                <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"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"</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token property">"caption"</span><span class="token operator">:</span> <span class="token string">"Name"</span><span class="token punctuation">,</span>
                <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"cr.ac.tec.student_id.name"</span><span class="token punctuation">,</span>
                <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"plain"</span><span class="token punctuation">,</span>
                <span class="token property">"hideValue"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"Raon Kim"</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token property">"caption"</span><span class="token operator">:</span> <span class="token string">"Student ID"</span><span class="token punctuation">,</span>
                <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"cr.ac.tec.student_id.student_id"</span><span class="token punctuation">,</span>
                <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"plain"</span><span class="token punctuation">,</span>
                <span class="token property">"hideValue"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"tec001"</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token property">"caption"</span><span class="token operator">:</span> <span class="token string">"Emision Date"</span><span class="token punctuation">,</span>
                <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"cr.ac.tec.student_id.emision_date"</span><span class="token punctuation">,</span>
                <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"plain"</span><span class="token punctuation">,</span>
                <span class="token property">"hideValue"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2025.08.01"</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token property">"caption"</span><span class="token operator">:</span> <span class="token string">"Expiration Date"</span><span class="token punctuation">,</span>
                <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"cr.ac.tec.student_id.expiration_date"</span><span class="token punctuation">,</span>
                <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"plain"</span><span class="token punctuation">,</span>
                <span class="token property">"hideValue"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"2035.08.01"</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token property">"caption"</span><span class="token operator">:</span> <span class="token string">"Major"</span><span class="token punctuation">,</span>
                <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"cr.ac.tec.student_id.major"</span><span class="token punctuation">,</span>
                <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"plain"</span><span class="token punctuation">,</span>
                <span class="token property">"hideValue"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"test"</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token property">"caption"</span><span class="token operator">:</span> <span class="token string">"University Branch"</span><span class="token punctuation">,</span>
                <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"cr.ac.tec.student_id.university_branch"</span><span class="token punctuation">,</span>
                <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"plain"</span><span class="token punctuation">,</span>
                <span class="token property">"hideValue"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"test"</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"did:omn:2m9e4mZ681NySDVRLqBNYXtBBCbW"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"encoding"</span><span class="token operator">:</span> <span class="token string">"UTF-8"</span><span class="token punctuation">,</span>
          <span class="token property">"evidence"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token property">"documentPresence"</span><span class="token operator">:</span> <span class="token string">"Physical"</span><span class="token punctuation">,</span>
              <span class="token property">"evidenceDocument"</span><span class="token operator">:</span> <span class="token string">"BusinessLicense"</span><span class="token punctuation">,</span>
              <span class="token property">"subjectPresence"</span><span class="token operator">:</span> <span class="token string">"Physical"</span><span class="token punctuation">,</span>
              <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"DocumentVerification"</span><span class="token punctuation">,</span>
              <span class="token property">"verifier"</span><span class="token operator">:</span> <span class="token string">"did:omn:tas"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"formatVersion"</span><span class="token operator">:</span> <span class="token string">"1.0"</span><span class="token punctuation">,</span>
          <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"9419575e-8d8c-4577-849a-e1d057ca1345"</span><span class="token punctuation">,</span>
          <span class="token property">"issuanceDate"</span><span class="token operator">:</span> <span class="token string">"2025-07-30T02:45:03Z"</span><span class="token punctuation">,</span>
          <span class="token property">"issuer"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"did:omn:issuer"</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"issuer"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"language"</span><span class="token operator">:</span> <span class="token string">"ko"</span><span class="token punctuation">,</span>
          <span class="token property">"proof"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"created"</span><span class="token operator">:</span> <span class="token string">"2025-07-30T02:45:03Z"</span><span class="token punctuation">,</span>
            <span class="token property">"proofPurpose"</span><span class="token operator">:</span> <span class="token string">"assertionMethod"</span><span class="token punctuation">,</span>
            <span class="token property">"proofValue"</span><span class="token operator">:</span> <span class="token string">"mIBsC4p8JFcVfUq07wTgRyXXmmmeAy4Kdkw5bf1DYLFiqTskXTGpqV6RGVcA3v7/z6R1RgKQLLyEXt/YHx0jeem4"</span><span class="token punctuation">,</span>
            <span class="token property">"proofValueList"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">"mH3CvwdPfFSpYw5I602tXn+1iyE9MpVvUlOObWUi3ZBbxHP14oOiZ7g97m9WT6VNUx7ePyQWep/8N6vbGZbdMIG4"</span><span class="token punctuation">,</span>
              <span class="token string">"mHxT06yaCVroALdXKMX3E1iaOFwr7OyajVFSSY0nO9IgCKOhGdVdPif1Gm/3Mg3g0hKcQvuRuHjbu3tzmjDSigvo"</span><span class="token punctuation">,</span>
              <span class="token string">"mH7EGmTHnznY2R/gjcLzomG1R/jLIGzhJHg/c4BGaAIGMaAbp3zAzdJz/AuN2kJGUD1s/OXwcZwtXRKyzQHUqPyM"</span><span class="token punctuation">,</span>
              <span class="token string">"mIF765kKT9YOE1s2W1exUvkOnSgW/a2xhAQw8Nr6mdW/LAUJwDzLB6bfAaM4SFbWRF8iI+q4cKBtVXkV/0jktyuM"</span><span class="token punctuation">,</span>
              <span class="token string">"mH3CvwdPfFSpYw5I602tXn+1iyE9MpVvUlOObWUi3ZBbxHP14oOiZ7g97m9WT6VNUx7ePyQWep/8N6vbGZbdMIG4"</span><span class="token punctuation">,</span>
              <span class="token string">"mH3CvwdPfFSpYw5I602tXn+1iyE9MpVvUlOObWUi3ZBbxHP14oOiZ7g97m9WT6VNUx7ePyQWep/8N6vbGZbdMIG4"</span><span class="token punctuation">,</span>
              <span class="token string">"mIPmjZyC1kGxqnvRi8j4h6JAkDmWW9Th0TAVTNlUIABGcAoJRZP4LlEE8ygltHUW1DASeqE2LZViI7il00zhgmqY"</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Secp256r1Signature2018"</span><span class="token punctuation">,</span>
            <span class="token property">"verificationMethod"</span><span class="token operator">:</span> <span class="token string">"did:omn:issuer?versionId=1#assert"</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"VerifiableCredential"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">"validFrom"</span><span class="token operator">:</span> <span class="token string">"2025-07-30T02:45:03Z"</span><span class="token punctuation">,</span>
          <span class="token property">"validUntil"</span><span class="token operator">:</span> <span class="token string">"2026-07-30T02:45:03Z"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"signature"</span><span class="token operator">:</span> <span class="token string">"mock_signature"</span>
<span class="token punctuation">}</span></code></pre>
                </div>
              </div>
            </div>

            <!-- Server Response -->
            <div>
              <h4 class="text-md font-semibold mb-3">Server Response</h4>
              <pre id="mockServerResponse" class="bg-gray-100 p-4 rounded-lg overflow-auto h-96 language-json" tabindex="0"><code class="language-json"><span class="token comment">// Server response will appear here</span></code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Flow Visualization Tab -->
    <div id="flow-tab" class="tab-content p-6">
      <div class="mb-6">
        <h3 class="text-lg font-semibold mb-4">OID4VP Flow Visualization</h3>

        <!-- Flow Type Selection -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Flow Type</label>
          <select onchange="updateFlowDiagram(this.value)" class="w-48 px-3 py-2 border border-gray-300 rounded-md">
            <option value="by_value">By Value Flow</option>
            <option value="request_uri">Request URI Flow</option>
          </select>
        </div>

        <div id="flowByValue" class="flow-diagram rounded-lg p-8 text-white">
          <div class="grid grid-cols-3 gap-8 text-center">
            <div>
              <div class="bg-white bg-opacity-20 rounded-lg p-6">
                <h4 class="font-semibold mb-2">1. Initiate</h4>
                <p class="text-sm">Verifier creates full authorization request with DCQL query</p>
              </div>
            </div>
            <div>
              <div class="bg-white bg-opacity-20 rounded-lg p-6">
                <h4 class="font-semibold mb-2">2. Process</h4>
                <p class="text-sm">Wallet receives &amp; processes query directly from URL</p>
              </div>
            </div>
            <div>
              <div class="bg-white bg-opacity-20 rounded-lg p-6">
                <h4 class="font-semibold mb-2">3. Response</h4>
                <p class="text-sm">VP Token sent via Direct Post</p>
              </div>
            </div>
          </div>
        </div>

        <div id="flowRequestUri" class="flow-diagram rounded-lg p-8 text-white hidden">
          <div class="grid grid-cols-4 gap-6 text-center">
            <div>
              <div class="bg-white bg-opacity-20 rounded-lg p-4">
                <h4 class="font-semibold mb-2">1. Initiate</h4>
                <p class="text-xs">Verifier creates request_uri</p>
              </div>
            </div>
            <div>
              <div class="bg-white bg-opacity-20 rounded-lg p-4">
                <h4 class="font-semibold mb-2">2. Fetch</h4>
                <p class="text-xs">Wallet fetches from /request/{id}</p>
              </div>
            </div>
            <div>
              <div class="bg-white bg-opacity-20 rounded-lg p-4">
                <h4 class="font-semibold mb-2">3. Process</h4>
                <p class="text-xs">Wallet processes DCQL query</p>
              </div>
            </div>
            <div>
              <div class="bg-white bg-opacity-20 rounded-lg p-4">
                <h4 class="font-semibold mb-2">4. Response</h4>
                <p class="text-xs">VP Token sent</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Active Sessions -->
      <div>
        <h3 class="text-lg font-semibold mb-4">Active Verification Sessions</h3>
        <div id="activeSessions" class="space-y-2"></div>
      </div>
    </div>

    <!-- Debug Logs Tab -->
    <div id="logs-tab" class="tab-content p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">Debug Console</h3>
        <button onclick="clearLogs()" class="text-sm text-red-600 hover:text-red-800">Clear Logs</button>
      </div>
      <div id="debugLogs" class="bg-gray-900 text-gray-100 p-4 rounded-lg h-96 overflow-auto font-mono text-sm"><div class="text-green-400"></div>
    </div>
  </div>

  <!-- Request URI Test Modal -->
  <div id="requestUriModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
    <div class="relative top-20 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white">
      <div class="mt-3">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Request URI Test Result</h3>
        <pre id="requestUriTestResult" class="bg-gray-100 p-4 rounded text-sm overflow-auto max-h-96 language-json" tabindex="0"><code class="language-json"><span class="token comment">// Request object will appear here</span></code>
        </pre>
        <button onclick="closeRequestUriModal()" class="mt-4 w-full bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Global variables
  let currentSession = null;
  let qrInstance = null;
  let activeSessions = {};

  // Tab switching
  function switchTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => {
      tab.classList.remove('active');
    });
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.classList.remove('active');
    });

    document.getElementById(tabName + '-tab').classList.add('active');
    event.target.classList.add('active');

    // Update mock session select if switching to direct test
    if (tabName === 'direct-test') {
      updateMockSessionSelect();
    }
  }

  // Sub-tab switching for direct test
  function switchDirectTestSubTab(subTabName) {
    document.querySelectorAll('.sub-tab-content').forEach(tab => {
      tab.classList.remove('active');
    });
    document.querySelectorAll('.sub-tab-button').forEach(btn => {
      btn.classList.remove('active');
    });

    document.getElementById(subTabName + '-test-tab').classList.add('active');
    event.target.classList.add('active');
  }

  // Switch Request Mode
  function switchRequestMode(mode) {
    document.querySelectorAll('.request-mode-content').forEach(content => {
      content.classList.remove('active');
    });

    if (mode === 'by_value') {
      document.getElementById('byValueOptions').classList.add('active');
    } else {
      document.getElementById('requestUriOptions').classList.add('active');
    }
  }

  // Update Flow Diagram
  function updateFlowDiagram(flowType) {
    if (flowType === 'by_value') {
      document.getElementById('flowByValue').classList.remove('hidden');
      document.getElementById('flowRequestUri').classList.add('hidden');
    } else {
      document.getElementById('flowByValue').classList.add('hidden');
      document.getElementById('flowRequestUri').classList.remove('hidden');
    }
  }

  // Load DCQL template
  function loadTemplate(template) {
    const templates = {
      identity: {
        credentials: [{
          id: "identity_credential",
          format: "jwt_vc_json",
          meta: {
            vct_values: ["https://credentials.example.com/identity_credential"]
          },
          claims: [
            {path: ["credentialSubject", "given_name"]},
            {path: ["credentialSubject", "family_name"]},
            {path: ["credentialSubject", "birth_date"]}
          ]
        }]
      },
      age: {
        credentials: [{
          id: "age_verification",
          format: "jwt_vc_json",
          claims: [{
            id: "age_over_18",
            path: ["credentialSubject", "age_over_18"],
            values: [true]
          }]
        }]
      },
      education: {
        credentials: [{
          id: "university_degree",
          format: "jwt_vc_json",
          meta: {
            vct_values: ["https://example.edu/credentials/degree"]
          },
          claims: [
            {path: ["credentialSubject", "degree", "type"]},
            {path: ["credentialSubject", "degree", "name"]},
            {path: ["credentialSubject", "degree", "university"]}
          ],
          purpose: "Educational background verification"
        }]
      },
      driver: {
        credentials: [{
          id: "driver_license",
          format: "mso_mdoc",
          meta: {
            doctype_values: ["org.iso.18013.5.1.mDL"]
          },
          claims: [
            {path: ["org.iso.18013.5.1", "family_name"]},
            {path: ["org.iso.18013.5.1", "given_name"]},
            {path: ["org.iso.18013.5.1", "birth_date"]},
            {path: ["org.iso.18013.5.1", "document_number"]}
          ]
        }]
      },
      complex: {
        credentials: [
          {
            id: "identity_credential",
            format: "jwt_vc_json",
            meta: {
              vct_values: ["https://credentials.example.com/identity_credential"]
            },
            claims: [
              {path: ["credentialSubject", "given_name"]},
              {path: ["credentialSubject", "family_name"]}
            ]
          },
          {
            id: "employment_credential",
            format: "jwt_vc_json",
            meta: {
              vct_values: ["https://credentials.example.com/employment_credential"]
            },
            claims: [
              {path: ["credentialSubject", "employer"]},
              {path: ["credentialSubject", "position"]}
            ]
          }
        ],
        credential_sets: [{
          id: "verified_employee",
          options: [
            ["identity_credential", "employment_credential"]
          ],
          purpose: "Verify employed person identity"
        }]
      },
      tec: {
        "credentials": [
          {
            "id": "tec_student_id",
            "format": "vc",
            "multiple": false,
            "meta": {
              "issuer_values": [
                "did:omn:issuer"
              ]
            }
          }
        ]
      }
    };

    if (template && templates[template]) {
      document.getElementById('dcqlQuery').value = JSON.stringify(templates[template], null, 2);
      addLog('Loaded template: ' + template, 'info');
    }
  }

  // Format JSON
  function formatJSON() {
    try {
      const input = document.getElementById('dcqlQuery').value;
      const parsed = JSON.parse(input);
      document.getElementById('dcqlQuery').value = JSON.stringify(parsed, null, 2);
      addLog('JSON formatted successfully', 'success');
    } catch (e) {
      addLog('JSON format error: ' + e.message, 'error');
    }
  }

  // Validate DCQL
  async function validateDCQL() {
    try {
      const dcqlQuery = document.getElementById('dcqlQuery').value;
      const response = await fetch('/oid4vp/validate-dcql', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: dcqlQuery
      });

      const result = await response.json();

      const resultsDiv = document.getElementById('validationResults');
      const contentDiv = document.getElementById('validationContent');

      resultsDiv.classList.remove('hidden');

      if (result.valid) {
        contentDiv.innerHTML = `
          <div class="text-green-700">
            <p class="font-semibold">✓ Valid DCQL Query</p>
            <p>Credentials: ${result.credentialCount || 0}</p>
            <p>Credential Sets: ${result.credentialSetCount || 0}</p>
          </div>
        `;
        addLog('DCQL validation passed', 'success');
      } else {
        contentDiv.innerHTML = `
          <div class="text-red-700">
            <p class="font-semibold">✗ Invalid DCQL Query</p>
            <p>${result.message}</p>
          </div>
        `;
        addLog('DCQL validation failed: ' + result.message, 'error');
      }
    } catch (e) {
      addLog('Validation error: ' + e.message, 'error');
    }
  }

  // Copy URL
  function copyUrl(elementId) {
    const urlText = document.getElementById(elementId).textContent;
    navigator.clipboard.writeText(urlText).then(() => {
      addLog(`URL copied to clipboard`, 'success');
    });
  }

  // Copy JWT
  function copyJWT() {
    const jwt = document.getElementById('generatedJWT').value;
    navigator.clipboard.writeText(jwt).then(() => {
      addLog('JWT copied to clipboard', 'success');
    });
  }

  // Same Device Flow
  function openInSameDevice() {
    const url = document.getElementById('authRequestUrl').textContent;
    if (url) {
      window.open(url, '_blank');
      addLog('Opened authorization URL in new tab', 'info');
    }
  }

  // Test Request URI endpoint
  async function testRequestUri() {
    if (!currentSession || !currentSession.request_uri) {
      addLog('No request URI available', 'error');
      return;
    }

    try {
      addLog('Testing request URI endpoint...', 'info');

      const response = await fetch(currentSession.request_uri);
      const result = await response.json();

      document.getElementById('requestUriTestResult').innerHTML =
          `<code class="language-json">${JSON.stringify(result, null, 2)}</code>`;
      Prism.highlightElement(document.querySelector('#requestUriTestResult code'));

      document.getElementById('requestUriModal').classList.remove('hidden');

      addLog('Request URI endpoint tested successfully', 'success');
    } catch (e) {
      addLog('Request URI test error: ' + e.message, 'error');
    }
  }

  // Close Request URI Modal
  function closeRequestUriModal() {
    document.getElementById('requestUriModal').classList.add('hidden');
  }

  // Initiate verification
  async function initiateVerification() {
    try {
      // Show QR container
      document.getElementById('qrContainer').classList.remove('hidden');

      const dcqlQuery = document.getElementById('dcqlQuery').value;
      const requestMode = document.querySelector('input[name="requestMode"]:checked').value;
      const responseMode = document.querySelector('input[name="responseMode"]:checked').value;
      const clientMetadata = document.getElementById('clientMetadata').value;

      const params = new URLSearchParams({
        dcql_query: dcqlQuery,
        response_mode: responseMode
      });

      if (clientMetadata.trim()) {
        params.append('client_metadata', clientMetadata);
      }

      // Add use_request_uri parameter if in request_uri mode
      if (requestMode === 'request_uri') {
        params.append('use_request_uri', 'true');
      }

      addLog(`Initiating verification session in ${requestMode} mode...`, 'info');

      const response = await fetch('/oid4vp/initiate', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: params
      });

      const result = await response.json();

      if (result.authorization_request_uri) {
        currentSession = result;
        // Store in active sessions
        activeSessions[result.state] = {
          ...result,
          timestamp: new Date().toISOString(),
          dcqlQuery: JSON.parse(dcqlQuery),
          requestMode: requestMode
        };

        displayQRCode(result.authorization_request_uri);
        document.getElementById('requestId').textContent = result.request_id;

        // Display URLs
        document.getElementById('authRequestUrl').textContent = result.authorization_request_uri;

        // Handle Request URI specific display
        if (requestMode === 'request_uri' && result.request_uri) {
          document.getElementById('requestUri').textContent = result.request_uri;
          document.getElementById('requestUriDisplay').classList.remove('hidden');
          document.getElementById('testRequestUriBtn').classList.remove('hidden');
        } else {
          document.getElementById('requestUriDisplay').classList.add('hidden');
          document.getElementById('testRequestUriBtn').classList.add('hidden');
        }

        addLog('Session initiated successfully', 'success');
        addLog('Request ID: ' + result.request_id, 'info');
        addLog('State: ' + result.state, 'info');

        if (requestMode === 'request_uri') {
          addLog('Request URI: ' + result.request_uri, 'info');
          addLog('Wallet will fetch full request from the URI', 'info');
        } else {
          addLog('Full request included in authorization URL', 'info');
        }

        updateActiveSessions();
        updateMockSessionSelect();
      } else {
        addLog('Initiation failed: ' + (result.error_description || 'Unknown error'), 'error');
      }
    } catch (e) {
      addLog('Request error: ' + e.message, 'error');
    }
  }

  // Display QR Code
  function displayQRCode(uri) {
    const container = document.getElementById('qrContainer');
    container.classList.remove('hidden');

    const qrDiv = document.getElementById('qrcode');
    qrDiv.innerHTML = '';

    qrInstance = new QRCode(qrDiv, {
      text: uri,
      width: 256,
      height: 256,
      colorDark: "#000000",
      colorLight: "#ffffff",
      correctLevel: QRCode.CorrectLevel.L
    });
  }

  // Test scope mapping
  async function testScopeMapping() {
    try {
      const checkboxes = document.querySelectorAll('.scope-checkbox:checked');
      const customScope = document.getElementById('customScope').value;

      let scopes = [];
      checkboxes.forEach(cb => scopes.push(cb.value));

      if (customScope.trim()) {
        scopes = scopes.concat(customScope.trim().split(/\s+/));
      }

      const scopeString = scopes.join(' ');

      if (!scopeString) {
        addLog('No scopes selected', 'warning');
        return;
      }

      addLog('Testing scope mapping for: ' + scopeString, 'info');

      const params = new URLSearchParams({
        scope: scopeString,
        response_mode: 'direct_post'
      });

      const response = await fetch('/oid4vp/initiate', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: params
      });

      const result = await response.json();

      const resultDiv = document.getElementById('scopeMappingResult');

      if (result.mapped_dcql) {
        resultDiv.innerHTML = `<code class="language-json">${JSON.stringify(JSON.parse(result.mapped_dcql), null, 2)}</code>`;
        Prism.highlightElement(resultDiv.querySelector('code'));
        addLog('Scope mapping successful', 'success');
      } else if (result.error) {
        resultDiv.innerHTML = `<code class="language-json">${JSON.stringify(result, null, 2)}</code>`;
        Prism.highlightElement(resultDiv.querySelector('code'));
        addLog('Scope mapping failed: ' + result.error_description, 'error');
      }
    } catch (e) {
      addLog('Scope mapping error: ' + e.message, 'error');
    }
  }

  // Submit Manual VP Token
  async function submitManualVPToken() {
    try {
      const vpToken = document.getElementById('manualVpToken').value.trim();
      const state = document.getElementById('manualState').value.trim();

      if (!vpToken) {
        addLog('VP Token is required', 'error');
        return;
      }

      const params = new URLSearchParams({
        vp_token: vpToken
      });

      if (state) {
        params.append('state', state);
      }

      addLog('Submitting manual VP Token...', 'info');

      const response = await fetch('/oid4vp/response', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: params
      });

      const result = await response.json();

      document.getElementById('manualTestResponse').innerHTML =
          `<code class="language-json">${JSON.stringify(result, null, 2)}</code>`;
      Prism.highlightElement(document.querySelector('#manualTestResponse code'));

      if (result.redirect_uri) {
        addLog('VP Token accepted - Success redirect: ' + result.redirect_uri, 'success');
      } else if (result.error) {
        addLog('VP Token rejected: ' + result.error_description, 'error');
      }
    } catch (e) {
      addLog('Manual submission error: ' + e.message, 'error');
    }
  }

  // Update session details
  function updateSessionDetails() {
    const sessionId = document.getElementById('mockSessionSelect').value;
    if (sessionId && activeSessions[sessionId]) {
      const session = activeSessions[sessionId];
      document.getElementById('sessionDetails').innerHTML = `
        <pre class="text-sm"><code class="language-json">${JSON.stringify(session, null, 2)}</code></pre>
      `;
      Prism.highlightElement(document.querySelector('#sessionDetails code'));
    } else {
      document.getElementById('sessionDetails').innerHTML = '<p class="text-gray-600">Select a session to see details</p>';
    }
  }

  // Switch Credential Format
  function switchCredentialFormat() {
    const format = document.getElementById('credentialFormat').value;
    const mockCredential = document.getElementById('mockCredential');

    if (format === 'sd_jwt') {
      // Load SD-JWT credential template
      mockCredential.value = JSON.stringify({
        "iss": "https://issuer.example.com",
        "iat": Math.floor(Date.now() / 1000),
        "exp": Math.floor(Date.now() / 1000) + 86400,
        "vct": "https://credentials.example.com/identity_credential",
        "cnf": {
          "jwk": {
            "kty": "EC",
            "crv": "P-256",
            "x": "TCAER19Zvu3OHF4j4W4vfSVoHIP1ILilDls7vCeGemc",
            "y": "ZxjiWWbZMQGHVWKVQ4hbSIirsVfuecCE6t4jT9F2HZQ"
          }
        },
        "_sd": [
          "CrQe7S5kqBAHt-nMYXgc6bdt2SH5aTY1sU_M-PgkjPI",
          "JzYjH4svliH0R3PyEMfeZu6Jt69u5qehZo7F7EPYlSE"
        ],
        "_sd_alg": "sha-256"
      }, null, 2);
      addLog('Loaded SD-JWT credential template', 'info');
    } else {
      // Load standard JWT VC template (existing)
      mockCredential.value = `{
   "@context":[
      "https://www.w3.org/ns/credentials/v2"
   ],
   "credentialSchema":{
      "id":"http://10.48.17.124:8099/issuer/api/v1/vc/vcschema?name=tec.student_id",
      "type":"OsdSchemaCredential"
   },
   "credentialSubject":{
      "claims":[
         {
            "caption":"Name",
            "code":"cr.ac.tec.student_id.name",
            "format":"plain",
            "hideValue":false,
            "type":"text",
            "value":"Raon Kim"
         },
         {
            "caption":"Student ID",
            "code":"cr.ac.tec.student_id.student_id",
            "format":"plain",
            "hideValue":false,
            "type":"text",
            "value":"tec001"
         }
      ],
      "id":"did:omn:2m9e4mZ681NySDVRLqBNYXtBBCbW"
   },
   "encoding":"UTF-8",
   "formatVersion":"1.0",
   "id":"9419575e-8d8c-4577-849a-e1d057ca1345",
   "issuanceDate":"2025-07-30T02:45:03Z",
   "issuer":{
      "id":"did:omn:issuer",
      "name":"issuer"
   },
   "language":"ko"
}`;
      addLog('Loaded JWT VC credential template', 'info');
    }
  }

  // Send Mock Response
  async function sendMockResponse() {
    try {
      const sessionId = document.getElementById('mockSessionSelect').value;
      const mockCredential = JSON.parse(document.getElementById('mockCredential').value);

      if (!sessionId) {
        addLog('Please select an active session', 'error');
        return;
      }

      const session = activeSessions[sessionId];
      if (!session) {
        addLog('Session not found', 'error');
        return;
      }

      // If Request URI mode, simulate fetching from request URI first
      if (session.requestMode === 'request_uri' && session.request_uri) {
        addLog('Mock wallet: Fetching request from URI...', 'info');

        try {
          const requestResponse = await fetch(session.request_uri);
          const requestObject = await requestResponse.json();
          addLog('Mock wallet: Retrieved request object', 'success');

          // Display the fetched request object in session details
          document.getElementById('sessionDetails').innerHTML = `
            <div class="mb-4">
              <h5 class="font-semibold text-sm mb-2">Original Session:</h5>
              <pre class="text-xs"><code class="language-json">${JSON.stringify(session, null, 2)}</code></pre>
            </div>
            <div>
              <h5 class="font-semibold text-sm mb-2">Fetched Request Object:</h5>
              <pre class="text-xs"><code class="language-json">${JSON.stringify(requestObject, null, 2)}</code></pre>
            </div>
          `;
          Prism.highlightAll();
        } catch (e) {
          addLog('Mock wallet: Failed to fetch from request URI', 'error');
        }
      }

      // Create mock VP Token
      const header = {
        alg: "RS256",
        typ: "JWT"
      };

      const vpClaims = {
        iss: "https://wallet.example.com",
        aud: session.client_id, // Use actual client_id from session
        iat: Math.floor(Date.now() / 1000),
        exp: Math.floor(Date.now() / 1000) + 3600,
        nonce: session.nonce,
        vp: {
          "@context": ["https://www.w3.org/2018/credentials/v1"],
          type: ["VerifiablePresentation"],
          verifiableCredential: [mockCredential]
        }
      };

      // UTF-8 문자열을 Base64URL로 안전하게 인코딩하는 함수
      function base64UrlEncode(str) {
        try {
          // 1. UTF-8 바이트 배열로 변환
          const utf8Bytes = new TextEncoder().encode(str);

          // 2. 바이트 배열을 문자열로 변환 후 Base64 인코딩
          const base64 = btoa(String.fromCharCode(...utf8Bytes));

          // 3. Base64를 Base64URL로 변환 (JWT 표준)
          return base64
          .replace(/\+/g, '-')  // + -> -
          .replace(/\//g, '_')  // / -> _
          .replace(/=/g, '');   // padding 제거
        } catch (error) {
          addLog('Base64URL encoding error: ' + error.message, 'error');
          throw error;
        }
      }

      // Mock JWT (UTF-8 안전한 인코딩)
      const mockVpToken = base64UrlEncode(JSON.stringify(header)) + '.' +
          base64UrlEncode(JSON.stringify(vpClaims)) + '.' +
          'mock_signature';

      // Display generated JWT
      document.getElementById('generatedJWT').value = mockVpToken;

      // Display decoded token
      const decodedDisplay = {
        header: header,
        payload: vpClaims,
        signature: "mock_signature"
      };
      document.getElementById('decodedToken').innerHTML =
          `<code class="language-json">${JSON.stringify(decodedDisplay, null, 2)}</code>`;
      Prism.highlightElement(document.querySelector('#decodedToken code'));

      // Submit the mock response
      const params = new URLSearchParams({
        vp_token: mockVpToken,
        state: session.state
      });

      addLog('Sending mock wallet response...', 'info');

      const response = await fetch('/oid4vp/response', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: params
      });

      const result = await response.json();

      // Display server response
      document.getElementById('mockServerResponse').innerHTML =
          `<code class="language-json">${JSON.stringify(result, null, 2)}</code>`;
      Prism.highlightElement(document.querySelector('#mockServerResponse code'));

      if (result.redirect_uri) {
        addLog('Mock response accepted - Success redirect: ' + result.redirect_uri, 'success');
      } else if (result.error) {
        addLog('Mock response rejected: ' + result.error_description, 'error');
      }
    } catch (e) {
      addLog('Mock response error: ' + e.message, 'error');
    }
  }

  // Update active sessions display
  function updateActiveSessions() {
    const container = document.getElementById('activeSessions');
    container.innerHTML = '';

    Object.entries(activeSessions).forEach(([state, session]) => {
      const sessionDiv = document.createElement('div');
      sessionDiv.className = 'bg-gray-100 p-3 rounded';
      sessionDiv.innerHTML = `
        <div class="flex justify-between items-center">
          <div>
            <span class="font-semibold">State:</span> ${state.substring(0, 8)}...
            <span class="ml-4 text-sm text-gray-600">${session.timestamp}</span>
            <span class="ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${session.requestMode || 'by_value'}</span>
          </div>
          <button onclick="removeSession('${state}')" class="text-red-600 hover:text-red-800">
            Remove
          </button>
        </div>
      `;
      container.appendChild(sessionDiv);
    });
  }

  // Update mock session select
  function updateMockSessionSelect() {
    const select = document.getElementById('mockSessionSelect');
    select.innerHTML = '<option value="">-- Select a session --</option>';

    Object.entries(activeSessions).forEach(([state, session]) => {
      const option = document.createElement('option');
      option.value = state;
      option.textContent = `${state.substring(0, 8)}... (${session.timestamp}) [${session.requestMode || 'by_value'}]`;
      select.appendChild(option);
    });
  }

  // Remove session
  function removeSession(state) {
    delete activeSessions[state];
    updateActiveSessions();
    updateMockSessionSelect();
    addLog('Removed session: ' + state, 'info');
  }

  // Add debug log
  function addLog(message, type = 'info') {
    const logsDiv = document.getElementById('debugLogs');
    const timestamp = new Date().toLocaleTimeString();

    const colors = {
      info: 'text-blue-400',
      success: 'text-green-400',
      error: 'text-red-400',
      warning: 'text-yellow-400'
    };

    const logEntry = document.createElement('div');
    logEntry.className = colors[type] || 'text-gray-400';
    logEntry.textContent = `[${timestamp}] ${message}`;

    logsDiv.appendChild(logEntry);
    logsDiv.scrollTop = logsDiv.scrollHeight;
  }

  // Clear logs
  function clearLogs() {
    const logsDiv = document.getElementById('debugLogs');
    logsDiv.innerHTML = '<div class="text-green-400">// Logs cleared</div>';
  }

  // Generate SD-JWT VP Token
  function generateSDJWTVPToken(credential, session) {
    try {
      // 1. Create Issuer-signed JWT (SD-JWT credential)
      const issuerHeader = {
        alg: "ES256",
        typ: "vc+sd-jwt"
      };

      const issuerPayload = {
        iss: "https://issuer.example.com",
        iat: Math.floor(Date.now() / 1000),
        exp: Math.floor(Date.now() / 1000) + 86400,
        vct: "https://credentials.example.com/identity_credential",
        cnf: {
          jwk: {
            kty: "EC",
            crv: "P-256",
            x: "TCAER19Zvu3OHF4j4W4vfSVoHIP1ILilDls7vCeGemc",
            y: "ZxjiWWbZMQGHVWKVQ4hbSIirsVfuecCE6t4jT9F2HZQ"
          }
        },
        // Add selective disclosure hashes
        _sd: [
          "CrQe7S5kqBAHt-nMYXgc6bdt2SH5aTY1sU_M-PgkjPI", // name claim
          "JzYjH4svliH0R3PyEMfeZu6Jt69u5qehZo7F7EPYlSE"  // student_id claim
        ],
        _sd_alg: "sha-256"
      };

      const issuerJWT = base64UrlEncode(JSON.stringify(issuerHeader)) + '.' +
          base64UrlEncode(JSON.stringify(issuerPayload)) + '.' +
          'mock_issuer_signature';

      // 2. Create disclosures (revealed claims)
      const nameDisclosure = base64UrlEncode(JSON.stringify([
        "salt_name_123", "name", "Raon Kim"
      ]));

      const studentIdDisclosure = base64UrlEncode(JSON.stringify([
        "salt_student_456", "student_id", "tec001"
      ]));

      // 3. Create Key Binding JWT (holder proof)
      const kbHeader = {
        alg: "ES256",
        typ: "kb+jwt"
      };

      const kbPayload = {
        iat: Math.floor(Date.now() / 1000),
        aud: session.client_id,
        nonce: session.nonce,
        sd_hash: "mock_sd_hash_value" // Hash of the SD-JWT
      };

      const keyBindingJWT = base64UrlEncode(JSON.stringify(kbHeader)) + '.' +
          base64UrlEncode(JSON.stringify(kbPayload)) + '.' +
          'mock_kb_signature';

      // 4. Construct SD-JWT: <Issuer-JWT>~<Disclosure1>~<Disclosure2>~<KB-JWT>
      const sdJwtToken = issuerJWT + '~' + nameDisclosure + '~' + studentIdDisclosure + '~' + keyBindingJWT;

      addLog('SD-JWT components: Issuer JWT + 2 disclosures + Key Binding JWT', 'info');
      return sdJwtToken;

    } catch (error) {
      addLog('SD-JWT generation error: ' + error.message, 'error');
      throw error;
    }
  }

  // Initialize credential format on page load
  document.addEventListener('DOMContentLoaded', function() {
    addLog('OID4VP Test Console initialized', 'success');
    formatJSON(); // Format default JSON
    loadTemplate('tec'); // Load TEC template by default
    switchCredentialFormat(); // Load default credential template
    switchRequestMode('request_uri'); // Set Request URI as default mode
  });
</script>

</body></html>